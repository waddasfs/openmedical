# 医生端快速启动指南

## 问题解决

您遇到的登录错误 `Wrong number of segments in token` 是因为Google OAuth2返回的是授权码而不是ID token。我已经修复了这个问题。

## 快速启动

### 1. 启动服务器
```bash
python main.py
```

### 2. 访问医生登录页面
打开浏览器访问：http://localhost:5000/doctor/login

### 3. 使用测试账户登录
我已经创建了3个测试医生账户，您可以直接点击按钮登录：

- **张医生** (普通医生) - `test_google_doctor_001`
- **李医生** (高级医生) - `test_google_doctor_002`  
- **王医生** (专家医生) - `test_google_doctor_003`

### 4. 测试功能
登录成功后，您可以测试以下功能：

- **仪表板**: 查看收入统计和最近咨询
- **咨询列表**: 管理分配给您的咨询
- **聊天功能**: 与患者进行实时聊天
- **收入统计**: 查看详细的收入数据

## 已修复的问题

1. **Google OAuth2认证**: 支持授权码和ID token两种方式
2. **测试登录**: 添加了简化的测试登录功能
3. **错误处理**: 改进了错误提示和处理逻辑

## 功能特性

### ✅ 实时聊天
- 医生与患者实时文字聊天
- 消息历史记录
- 自动刷新功能

### ✅ 咨询管理  
- 查看咨询列表
- 状态筛选（全部、待处理、进行中、已完成）
- 接诊和完成咨询

### ✅ 收入统计
- 总收入、本月、本周、今日收入
- 图表可视化
- 收入明细时间线
- 只读模式（不支持转账）

### ✅ Google登录
- 支持Google OAuth2认证
- 测试模式快速登录
- 安全的会话管理

## 测试脚本

运行测试脚本验证功能：
```bash
python test_doctor_login.py
```

## 注意事项

1. **测试模式**: 使用测试账户可以快速体验功能
2. **Google登录**: 需要配置Google OAuth2客户端ID
3. **数据库**: 确保MongoDB服务正在运行
4. **权限**: 医生只能访问分配给自己的咨询

## 故障排除

如果遇到问题：

1. **服务器启动失败**: 检查端口5000是否被占用
2. **数据库连接失败**: 确保MongoDB服务正在运行
3. **登录失败**: 使用测试账户进行快速登录
4. **页面显示异常**: 检查浏览器控制台错误

## 下一步

1. 配置Google OAuth2客户端ID和密钥
2. 创建更多测试数据
3. 测试完整的医生工作流程
4. 根据需要调整UI和功能

现在您可以正常使用医生端的所有功能了！
